
<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <title>Smiley editor</title>
    <script src="static/js/dom.js?ver=1552144735"></script>

</head>

<body>  
    
    <div id="root"></div>

    <script>
        NORMAL = Array.from('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz')
        BOLD_SERIF = Array.from(`ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—ğ€ğğ‚ğƒğ„ğ…ğ†ğ‡ğˆğ‰ğŠğ‹ğŒğğğğğ‘ğ’ğ“ğ”ğ•ğ–ğ—ğ˜ğ™ğšğ›ğœğğğŸğ ğ¡ğ¢ğ£ğ¤ğ¥ğ¦ğ§ğ¨ğ©ğªğ«ğ¬ğ­ğ®ğ¯ğ°ğ±ğ²ğ³`)
        ITALIC_SERIF = Array.from('0123456789ğ´ğµğ¶ğ·ğ¸ğ¹ğºğ»ğ¼ğ½ğ¾ğ¿ğ‘€ğ‘ğ‘‚ğ‘ƒğ‘„ğ‘…ğ‘†ğ‘‡ğ‘ˆğ‘‰ğ‘Šğ‘‹ğ‘Œğ‘ğ‘ğ‘ğ‘ğ‘‘ğ‘’ğ‘“ğ‘”â„ğ‘–ğ‘—ğ‘˜ğ‘™ğ‘šğ‘›ğ‘œğ‘ğ‘ğ‘Ÿğ‘ ğ‘¡ğ‘¢ğ‘£ğ‘¤ğ‘¥ğ‘¦ğ‘§')
        FRAKTUR = Array.from('0123456789ğ”„ğ”…â„­ğ”‡ğ”ˆğ”‰ğ”Šâ„Œâ„‘ğ”ğ”ğ”ğ”ğ”‘ğ”’ğ”“ğ””â„œğ”–ğ”—ğ”˜ğ”™ğ”šğ”›ğ”œâ„¨ğ”ğ”Ÿğ” ğ”¡ğ”¢ğ”£ğ”¤ğ”¥ğ”¦ğ”§ğ”¨ğ”©ğ”ªğ”«ğ”¬ğ”­ğ”®ğ”¯ğ”°ğ”±ğ”²ğ”³ğ”´ğ”µğ”¶ğ”·')
        BOLD_FRAKTUR = Array.from('0123456789ğ•¬ğ•­ğ•®ğ•¯ğ•°ğ•±ğ•²ğ•³ğ•´ğ•µğ•¶ğ•·ğ•¸ğ•¹ğ•ºğ•»ğ•¼ğ•½ğ•¾ğ•¿ğ–€ğ–ğ–‚ğ–ƒğ–„ğ–…ğ–†ğ–‡ğ–ˆğ–‰ğ–Šğ–‹ğ–Œğ–ğ–ğ–ğ–ğ–‘ğ–’ğ–“ğ–”ğ–•ğ––ğ–—ğ–˜ğ–™ğ–šğ–›ğ–œğ–ğ–ğ–Ÿ')
        MONOSPACE = Array.from('0ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ½ğŸ¾ğŸ¿ğ™°ğ™±ğ™²ğ™³ğ™´ğ™µğ™¶ğ™·ğ™¸ğ™¹ğ™ºğ™»ğ™¼ğ™½ğ™¾ğ™¿ğš€ğšğš‚ğšƒğš„ğš…ğš†ğš‡ğšˆğš‰ğšŠğš‹ğšŒğšğšğšğšğš‘ğš’ğš“ğš”ğš•ğš–ğš—ğš˜ğš™ğššğš›ğšœğšğšğšŸğš ğš¡ğš¢ğš£')
        STRIKETHROUGH_ORIG = Array.from('0Ì¶1Ì¶2Ì¶3Ì¶4Ì¶5Ì¶6Ì¶7Ì¶8Ì¶9Ì¶AÌ¶BÌ¶CÌ¶DÌ¶EÌ¶FÌ¶GÌ¶HÌ¶IÌ¶JÌ¶KÌ¶LÌ¶MÌ¶NÌ¶OÌ¶PÌ¶QÌ¶RÌ¶SÌ¶TÌ¶UÌ¶VÌ¶WÌ¶XÌ¶YÌ¶ZÌ¶aÌ¶bÌ¶cÌ¶dÌ¶eÌ¶fÌ¶gÌ¶hÌ¶iÌ¶jÌ¶kÌ¶lÌ¶mÌ¶nÌ¶oÌ¶pÌ¶qÌ¶rÌ¶sÌ¶tÌ¶uÌ¶vÌ¶wÌ¶xÌ¶yÌ¶zÌ¶')
        STRIKETHROUGH = []
        for(i=0;i<STRIKETHROUGH_ORIG.length;i+=2){
            STRIKETHROUGH.push(STRIKETHROUGH_ORIG[i] + STRIKETHROUGH_ORIG[i+1])
        }

        SMILEYS = "ğŸ˜€ğŸ˜ƒğŸ˜ğŸ˜¦ğŸ˜ğŸ˜ğŸ‘¾ğŸ™ŠğŸ’¯ğŸ‘‹ğŸ‘ŒğŸ‘ğŸ˜ˆâ¤ğŸ’›ğŸ’šğŸ’™ğŸ‡ğŸŒ³"

        class ControlButton_ extends Button{
            constructor(caption, action){
                super(caption, action)
                this.bc("#eee").pad(5).mar(3).curlyborder()
            }
        }
        function ControlButton(caption, action){return new ControlButton_(caption, action)}

        function encode(content, kind){
            result = ""
            for(c of Array.from(content)){
                index = NORMAL.indexOf(c)
                if(index < 0) result = `${result}${c}`
                else result += kind[index]
            }
            return result
        }

        textwidth = 700

        plaintext = TextArea().w(textwidth).h(200).bc("#eee")
            .ae("keyup", plaintextkeyup)
            .ae("input", plaintextkeyup)
        renderedtext = TextArea().w(textwidth).h(200)

        function plaintextkeyup(){
            t = plaintext.getText()
            t = t.replace(/:\)/g, "ğŸ˜ƒ")
            t = t.replace(/:\(/g, "ğŸ˜¦")            
            while(m = t.match(/\[b\](.*?)\[\/b\]/)){
                t = t.replace(m[0], encode(m[1], BOLD_SERIF))
            }
            while(m = t.match(/\[i\](.*?)\[\/i\]/)){
                t = t.replace(m[0], encode(m[1], ITALIC_SERIF))
            }                        
            while(m = t.match(/\[s\](.*?)\[\/s\]/)){
                t = t.replace(m[0], encode(m[1], STRIKETHROUGH))
            }                        
            while(m = t.match(/\[fr\](.*?)\[\/fr\]/)){
                t = t.replace(m[0], encode(m[1], FRAKTUR))
            }                        
            while(m = t.match(/\[bfr\](.*?)\[\/bfr\]/)){
                t = t.replace(m[0], encode(m[1], BOLD_FRAKTUR))
            }                        
            while(m = t.match(/\[code\]([\s\S]*?)\[\/code\]/)){
                let lines = []
                for(line of m[1].split("\n")){
                    startspaces = line.match(/^\s*/)                    
                    if(startspaces){
                        line = line.replace(startspaces[0], "\u{2000}".repeat(startspaces[0].length))
                    }
                    lines.push(line)
                }
                c = lines.join("\n")                
                t = t.replace(m[0], encode(c, MONOSPACE))
            }                        
            renderedtext.setText(t)
            infopanel.html("")
            setTimeout(() => {
                plaintext.focus()
            }, 10)
            return t
        }

        function tagselection(tag){            
            plaintext.rs(`[${tag}]${plaintext.gs()}[/${tag}]`)
            plaintextkeyup()
        }

        function removetags(){
            s = plaintext.gs()
            s = s.replace(/\[.*?\]/g, "")
            plaintext.rs(s)
            plaintextkeyup()
        }

        function setbold(){
            tagselection("b")
        }

        function setitalic(){
            tagselection("i")
        }

        function setstrikethrough(){
            tagselection("s")
        }

        function setfraktur(){
            tagselection("fr")
        }

        function setboldfraktur(){
            tagselection("bfr")
        }

        function setcode(){
            tagselection("code")
        }

        function copy(){
            renderedtext.selectall()
            document.execCommand("copy")
            infopanel.html(`copied to clipbard ${renderedtext.getText().length} characters`)
        }

        TEXTSEPWIDTHCHARS = 50

        SEP = "ğŸ“˜"
        SEPLINE = SEP.repeat(TEXTSEPWIDTHCHARS)

        function theme(){
            let lines = [SEPLINE, SEP]
            t = plaintextkeyup()                   
            for(line of t.split("\n")){                
                lines.push(`${SEP}${"\u{2000}\u{2000}\u{2000}"}${line}`)                
            }            
            lines.push(SEP)            
            lines.push(SEPLINE)   
            lines.push(`${SEP}${"\u{2000}"}${encode("created by", ITALIC_SERIF)} ${encode("Smiley Editor", BOLD_SERIF)} ğŸ“™ğŸ“™ğŸ“™ https://fbserv.herokuapp.com/smileyeditor.html ğŸ“™ğŸ“™ğŸ“™`)
            lines.push(SEPLINE)            
            t = lines.join("\n")
            renderedtext.setText(t)            
        }

        function addsmiley(smiley){
            plaintext.insert(smiley)            
            plaintextkeyup()
        }

        roote = document.getElementById("root")
        root = Div()        
        controlpanel = Div().pad(3).curlyborder().bc("#ffe").mb(3).w(textwidth)
        bcontrol = ControlButton("[B]", setbold).fw("bold")
        icontrol = ControlButton("[I]", setitalic).fst("italic")
        scontrol = ControlButton("[SÌ¶]", setstrikethrough)
        frcontrol = ControlButton("[ğ”‰]", setfraktur)
        bfrcontrol = ControlButton("[ğ•±]", setboldfraktur)
        ccontrol = ControlButton("[code]", setcode).ff("monospace")
        rtcontrol = ControlButton("remove tags", removetags).bc("#fee")
        themecontrol = ControlButton("Theme", theme).bc("#eff")
        unthemecontrol = ControlButton("unTheme", plaintextkeyup).bc("#fee")
        copycontrol = ControlButton("Copy", copy).bc("#efe")        
        controlpanel.a(bcontrol, icontrol, ccontrol, scontrol, frcontrol, bfrcontrol, rtcontrol, themecontrol, unthemecontrol, copycontrol)
        smileypanel = Div().pad(3).curlyborder().bc("#fff").mb(3).w(textwidth)
        for(let smiley of Array.from(SMILEYS)){
            smileypanel.a(ControlButton(smiley, function(){addsmiley(smiley)}))
        }
        infopanel = Div().pad(3).curlyborder().bc("#eef").mb(3).w(textwidth - 5).ff("monospace").pl(8)
        plaintextdiv = Div().a(plaintext)
        plaintext.setText("Type some text in [b]bold[/b] :( or [i]italic[/i] :) .\n\n[code]\nfunction(x)\n  {\n    return 2*x\n  }\n[/code]")
        plaintextkeyup()
        renderedtextdiv = Div().a(renderedtext)        
        root.a(controlpanel, smileypanel, infopanel, plaintextdiv, renderedtextdiv)
        roote.appendChild(root.e)
        plaintext.e.focus()
    </script>
    
</body>

</html>